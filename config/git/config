# vim: filetype=gitconfig

[user]
	name = Ken Brucker

[init]
  defaultBranch = main

[core]
  autocrlf = input

	commentChar = ";"

[color]
  # color opts: normal, black, red, green, yellow, blue, magenta, cyan, or white
  ui = auto
  interactive = auto

[branch]
	sort = -committerdate

[tag]
	# Sort tags according to version strings
	sort=version:refname

[diff]
  tool = nvimdiff
   
[merge]
  tool = nvimdiff

[difftool]
  prompt = false

[difftool "opendiff"]
  cmd = /usr/bin/opendiff \"$LOCAL\" \"$REMOTE\" -merge \"$MERGED\" | cat

[difftool "sourcetree"]
  cmd = opendiff \"$LOCAL\" \"$REMOTE\"
  path = 

[mergetool "sourcetree"]
  cmd = /Applications/SourceTree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"
  trustExitCode = true

[pretty]
  # tut: http://gitimmersion.com/lab_10.html
  # ref: http://linux.die.net/man/1/git-log
  # Result: <short-sha> <commit-message> (<pointer-names>) -- <commit-author-name>; <relative-time>
  # nice = "%C(yellow)%h%C(reset) %C(white)%s%C(cyan)%d%C(reset) -- %an; %ar"
  #
  # Result: <short-sha> <author-date> | <commit msg> (<pointer-names>)
  nice = "%C(yellow)%h%C(reset) %ad | %s%d"

[fetch]
  prune = true

[pull]
  rebase = true

[push]
  default = simple
  followTags = true
  
[filter "media"]
  clean = git media clean %f
  smudge = git media smudge %f
  required = true

[commit]
#  template = ~/.stCommitMsg

[rebase]
	autoSquash = true
	updateRefs = true

# Turn on "Reuse Recorded Resolution"
[rerere]
  enabled = true

[maintenance]
	repo = /Users/ken/.dotfiles

[alias]
  # https://git.wiki.kernel.org/articles/a/l/i/Aliases.html
  
  # View defined aliases
  alias = "!git config --get-regexp ^alias\\. | sort | sed -e s/^alias\\.// -e s/\\ /\\ =\\ /"

  # Common aliases
  ci = commit
  co = checkout
  st = status
  br = branch

  type = cat-file -t
  dump = cat-file -p

  # `git remote prune origin`: remove remote-tracking branches that were deleted from the remote repo
  # `git gc`: cleanup unnecessary files and optimize the local repository
  # `git clean -df`: remove untracked files and directories from the working tree
  # `git stash clear`: remove all stashed states
  trim = !git remote prune origin && git gc
  cleanup = !git clean -df && git stash clear

  # Add untracked, remove deleted, and show status
  adda = !git add -A && git status

  # Pretty git branch display
	b = "branch --format='%(color:#cccc00)%(objectname:short) %(color:red)%(committerdate:short) %(color:bold white)%(refname:short)'"

	# Ignore white space (-w) and copied (-C) lines in blame
	blame = blame -w -C

  # Fetch a repository ($1) and checkout its ref ($2) HEAD
  # Use: `git browse https://github.com/necolas/dotfiles <commit-ish>`
  browse = !bash -c 'git fetch $1 ${2:-HEAD} && git checkout FETCH_HEAD' -

  # Diff what is staged for the next commit
  diffc = diff --cached
  # Diff overview
  diffst = diff --stat

  # Custom graph log (append any tree-ish)
  graph = log --pretty=nice --date-order --graph
  # Custom graph log for all branches
  grapha = log --pretty=nice --date-order --graph --all

  # Pretty one-line
	l = "log --pretty=format:'%C(#cccc00)%h %Cred%ad %Creset%<(60,trunc)%s%C(auto)%d %C(magenta)%<(15,trunc)%an' --date=format:'%y%m%d'"
  # Custom pretty log
  logp = log --pretty=nice --graph --date=short
  # Short log with name and email
  loge = log --pretty='%Cred%h%Creset %s - %C(bold blue)%ae <%an>%Creset'
  # Full commit id, title and local name
  logf = log --pretty='%Cred%H%Creset %s - %C(bold blue)%aN %Creset'
	# Log only refids
	logref = log --pretty="%h"
	# Log without merges
	logm = log --no-merges --pretty=format:'* %H | %ad | %s - %an' --date=format:'%Y-%m-%d'
	# Diffstat log
  logst = log --stat
  # Short format diffstat log
  logsf = log --stat --format=oneline --abbrev-commit

  # diffstat log for stash

  stashlog = stash list --stat --format=oneline --abbrev-commit

  # Fetch and checkout a GitHub Pull Request from a remote (defaults to `origin`)
  # Use: `git gh-pr 123` or `git gh-pr 123 upstream`
  gh-pr = !bash -c 'git fetch -fu ${2:-origin} refs/pull/$1/head:gh-pr/$1 && git checkout gh-pr/$1' -

  # Find out who is currently active on the repository
  # Displays committers in descending order of number of commits
  who = shortlog --numbered --summary --email --no-merges --since='3 months'

  # List files changed since main (or $1)
  files = "!f() { git diff --name-only $(git merge-base HEAD \"${1:-main}\"); }; f"

  # List files changed since main excluding deleted files
  files-no-del = "!f() { git diff --name-only --diff-filter=d $(git merge-base HEAD \"${1:-main}\"); }; f"

  # List files changed since main excluding deleted files
  files-del = "!f() { git diff --name-only --diff-filter=D $(git merge-base HEAD \"${1:-main}\"); }; f"

  # Same as files but with diff --stat
  stat = "!f() { git diff --stat $(git merge-base HEAD \"${1:-main}\"); }; f"

  # Review files changed since main (default main) using Diffview
  review = "!f() { nvim +\"DiffviewOpen ${1:-main}\"; }; f"

  # Edit files changed since main (no tabs)
  edit = "!f() { nvim $(git files-no-del $1); }; f"
  # Edit files changed since main in tabs
  editt = "!f() { nvim -p $(git files-no-del $1); }; f"

  # gitlab integration
  # Requires: git config --add remote.origin.fetch '+refs/merge-requests/*:refs/remotes/origin/merge-requests/*'
  mr = !sh -c 'git fetch $1 merge-requests/$2/head:mr-$1-$2 && git checkout mr-$1-$2' -
  mro = !sh -c 'git checkout origin/merge-requests/$1/head' -

# Customize for Github repos
[includeif "hasconfig:remote.*.url:git@github.com:*/**"]
	path=~/.config/git/github.inc

# Customize for Codeberg repos
[includeif "hasconfig:remote.*.url:ssh://git@codeberg.org/**"]
	path=~/.config/git/codeberg.inc
