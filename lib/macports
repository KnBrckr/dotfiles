#!/bin/bash

run_macports() {

    # Check for Homebrew
    if type_exists 'port'; then
        e_header "Updating MacPorts..."
        # Use the latest version of MacPorts
        sudo port selfupdate
        [[ $? ]] && e_success "Done"

        e_header "Updating any existing MacPorts..."
        # Upgrade any already-installed ports
#        sudo port upgrade
        [[ $? ]] && e_success "Done"

        e_header "Checking status of desired Homebrew formulae..."
        local list_ports
        local -a missing_ports
        local -a desired_ports=(
        )

        for index in ${!desired_ports[*]}
        do
            if ! port_exists ${desired_ports[$index]}; then
                # Store the name (and options) of every missing port
                missing_ports=("${missing_ports[@]}" "${desired_ports[$index]}")
            fi
        done

        if [[ "$missing_ports" ]]; then
            # Convert the array of missing ports into a list of space-separate strings
            list_ports=$( printf "%s " "${missing_ports[@]}" )

            e_header "Installing missing MacPorts..."
            # Install all missing ports
			sudo port install $list_ports

            [[ $? ]] && e_success "Done"
        fi

        # Remove outdated versions
		sudo port uninstall inactive
    else
        printf "\n"
        e_error "Error: MacPorts not found."
        printf "Aborting...\n"
        exit
    fi

}
